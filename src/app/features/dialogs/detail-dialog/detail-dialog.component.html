<mat-card class="dashboard-card-dialog">
    <mat-card-header>

        @if (isMenu) {
            <h2 class="button-container-left text">@if (isNew) {
                {{ "create.page" | translate }}
            } @else {
                {{ "title.and.icons" | translate }}
            }</h2>
        } @else {
            <h2 class="button-container-left text">@if (isNew) {

                @if (isResidence) {
                    Unos novog stana
                }

                @if (isHotel) {
                    Unos novog apartmana
                }

                @if (isAuto) {
                    Unos novog Auto bloga
                }

                @if (isShoppingItem) {
                    Unos novog shoping itema
                }

                @if (isJob) {
                    Unos novog Job-a
                }

            } @else {

                @if (isResidence) {
                    Ažuriraj stan
                }

                @if (isHotel) {
                    Ažuriraj apartman
                }

                @if (isAuto) {
                    Ažuriraj Auto blog
                }

                @if (isShoppingItem) {
                    Ažuriraj shoping item
                }

                @if (isJob) {
                    Ažuriraj Job
                }

            }</h2>
        }


        <ng-container>
            <iso-buttons [countries]="languages" [selectedIn]="selectedIso" (selectedOut)="activeIso($event)">
            </iso-buttons>
        </ng-container>

    </mat-card-header>

    <mat-card-content [formGroup]="form">

        @if (isNew && !isNewMenu && isNewPanel) {

        } @else {
            <ng-container formGroupName="topMenu">
                <ng-container formArrayName="iso">
                    @for (item of isoArray; track item; let i = $index) {
                        @if (isIsoSelected(item.iso)) {
                            <div class="container">
                                <ng-container [formGroupName]="i">
                                    <mat-expansion-panel class="custom-panel" (opened)="isOpened = !isOpened"
                                                         (closed)="isOpened = !isOpened">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                @if (showTopMenuImage) {
                                                    <img src="{{showTopMenuImage}}" alt=""/>
                                                } @else if (topMenuIcon) {
                                                    <mat-icon class="icon-display-menutop">{{ topMenuIcon }}</mat-icon>
                                                }
                                                <div class="naslov">
                                                    <quill-view class="my-quill-view"
                                                                [content]="getTopMenuLabel(selectedIso)" format="html"
                                                                theme="snow"></quill-view>
                                                </div>
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <div class="actionButtons">
                                            <div class="text-text">Title</div>
                                            <quill-editor class="myEditor"
                                                          format="html"
                                                          [modules]="quillConfiguration"
                                                          [placeholder]="''"
                                                          formControlName="title"
                                                          (onContentChanged)="onContentChangedTopTitle($event)"
                                            ></quill-editor>

                                            @if (!isMenu) {
                                                <div class="text-text">Description</div>
                                                <quill-editor class="myEditor"
                                                              format="html"
                                                              [modules]="quillConfiguration"
                                                              [placeholder]="''"
                                                              formControlName="description"
                                                ></quill-editor>
                                            }

                                            <div class="text-text">Icon or Image</div>
                                            <div class="iconAndFile">
                                                @if (topMenuIcon) {
                                                    <button class="mybutton" (click)="openMenuIconDialog()" mat-fab>
                                                        <mat-icon class="myicon">{{ topMenuIcon }}</mat-icon>
                                                    </button>
                                                } @else {
                                                    <button class="mybutton" (click)="openMenuIconDialog()" mat-fab>
                                                        <mat-icon class="myicon">close</mat-icon>
                                                    </button>
                                                }
                                                <input #topMenuImageInput
                                                       (change)="selectTopMenuImage($event)"
                                                       class="form-control"
                                                       type="file"
                                                       accept="image/*"
                                                >

                                            </div>

                                            @if (Object.hasOwn(topFile, 'ext')) {
                                                <div class="iconAndFile">
                                                    <image-cropper
                                                            [imageQuality]="cropQuality"
                                                            [imageFile]="topFile.file"
                                                            format="png"
                                                            [onlyScaleDown]="true"
                                                            [resizeToWidth]="256"
                                                            [maintainAspectRatio]="false"
                                                            [aspectRatio]="getAspectRatio()"
                                                            (imageCropped)="topImageCropped($event)"
                                                    >
                                                    </image-cropper>
                                                </div>
                                            }
                                            <div class="iconAndFile">

                                                <div class="text-icon">
                                                    @if (!topMenuIcon) {
                                                        No Icon
                                                    }
                                                </div>

                                                @if (showTopMenuImage) {
                                                    <div>

                                                        @if (topMenuIcon) {
                                                            <mat-icon class="icon-display-tooltip"
                                                                      matTooltip="Remove image to see icon"
                                                                      matTooltipPosition="before">info
                                                            </mat-icon>
                                                        }

                                                        @if (Object.hasOwn(topFile, 'ext') || showTopMenuImage) {
                                                            <mat-checkbox class="iconAndFileDesc"
                                                                          (change)="onRemoveTopMenuImage($event)">
                                                                <div class="iconAndFileDesc">
                                                                    {{ "remove.image" | translate }}
                                                                </div>
                                                            </mat-checkbox>
                                                        }

                                                    </div>
                                                }
                                            </div>
                                            <mat-error></mat-error>

                                            {{ toBigTopMenuImage }}
                                        </div>
                                    </mat-expansion-panel>
                                    <!--                                    @if (isTopSearchEnabled) {-->
                                    <!--                                        <div class="eyes">-->
                                    <!--                                            @if (visible) {-->
                                    <!--                                                <i class="fa fa-eye fa-xl" (click)="setVisible()" aria-hidden="true"-->
                                    <!--                                                ></i>-->
                                    <!--                                            }-->
                                    <!--                                            @if (!visible) {-->
                                    <!--                                                <i class="fa fa-eye-slash fa-xl" (click)="setVisible()"-->
                                    <!--                                                   aria-hidden="true"></i>-->
                                    <!--                                            }-->
                                    <!--                                        </div>-->
                                    <!--                                    }-->
                                </ng-container>
                            </div>
                        }
                    }
                </ng-container>

                <ng-container formArrayName="properties">

                    @for (item of menuProductType?.properties; track item; let i = $index) {
                            <div class="container">
                                <ng-container [formGroupName]="i">

                                    @if (item.type === 'STRING' || item.type === 'INTEGER') {
                                        @if (item?.unit){
                                           <div [innerHtml]="innerUnit(item) | safeHtml"></div>
                                        } @else {
                                          {{item.name}}
                                        }
                                        <input type="{{item.type === 'STRING' ? 'text' : 'number'}}"
                                               class="form-control"
                                                formControlName="value"
                                        >
                                    } @else {

                                    }

                                </ng-container>
                            </div>


                    }
                </ng-container>
            </ng-container>

        }

        @if ((menuSide === Side.LEFT || menuSide === Side.RIGHT) && (isMenu || !this.isNew)) {
            <ng-container formGroupName="sideMenu">
                <ng-container formArrayName="iso">
                    @for (item of isoArray; track item; let i = $index) {
                        @if (isIsoSelected(item.iso)) {
                            <div class="container">
                                <ng-container [formGroupName]="i">
                                    <!--                                    <div class="text title2">Side menu</div>-->
                                    <mat-expansion-panel class="custom-panel" (opened)="isOpened = !isOpened"
                                                         (closed)="isOpened = !isOpened">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                @if (showSideMenuImage) {
                                                    <img src="{{showSideMenuImage}}" alt=""/>
                                                } @else if (sideMenuIcon) {
                                                    <mat-icon class="icon-display-menutop">{{ sideMenuIcon }}</mat-icon>
                                                }
                                                <div class="naslov">
                                                    <quill-view [content]="getSideMenuLabel(selectedIso)" format="html"
                                                                theme="snow"></quill-view>
                                                </div>
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <div class="actionButtons">
                                            <div class="text-text">Title</div>
                                            <quill-editor class="myEditor"
                                                          format="html"
                                                          [modules]="quillConfiguration"
                                                          [placeholder]="'title'"
                                                          formControlName="title"

                                                          (onContentChanged)="onContentChangedSideTitle($event)"
                                            ></quill-editor>
                                            <div class="text-text">Description</div>
                                            <quill-editor class="myEditor"
                                                          format="html"
                                                          [modules]="quillConfiguration"
                                                          [placeholder]="'description'"
                                                          formControlName="description"
                                            ></quill-editor>

                                            <div class="text-text">Icon or Image</div>

                                            <div class="iconAndFile">

                                                @if (sideMenuIcon) {
                                                    <button class="mybutton" (click)="openSideMenuIconDialog()" mat-fab>
                                                        <mat-icon class="myicon">{{ sideMenuIcon }}</mat-icon>
                                                    </button>
                                                } @else {
                                                    <button class="mybutton" (click)="openSideMenuIconDialog()" mat-fab>
                                                        <mat-icon class="myicon">close</mat-icon>
                                                    </button>
                                                }
                                                <input #sideMenuImageInput
                                                       (change)="selectSideMenuImage($event)"
                                                       class="form-control"
                                                       type="file"
                                                       accept="image/*"
                                                >
                                            </div>

                                            @if (Object.hasOwn(sideFile, 'ext')) {
                                                <div class="iconAndFile">
                                                    <image-cropper
                                                            [imageQuality]="cropQuality"
                                                            [imageFile]="sideFile.file"
                                                            format="png"
                                                            [onlyScaleDown]="true"
                                                            [resizeToWidth]="256"
                                                            [maintainAspectRatio]="false"
                                                            [aspectRatio]="getAspectRatio()"
                                                            (imageCropped)="sideImageCropped($event)"
                                                    >
                                                    </image-cropper>
                                                </div>
                                            }

                                            <div class="iconAndFile">
                                                <div class="text-icon">
                                                    @if (!sideMenuIcon) {
                                                        No Icon
                                                    }
                                                </div>
                                                @if (showSideMenuImage) {
                                                    <div>
                                                        @if (sideMenuIcon) {
                                                            <mat-icon class="icon-display-tooltip"
                                                                      matTooltip="Remove image to see icon"
                                                                      matTooltipPosition="before">info
                                                            </mat-icon>
                                                        }

                                                        @if (Object.hasOwn(sideFile, 'ext') || showSideMenuImage) {
                                                            <mat-checkbox class="iconAndFileDesc"
                                                                          (change)="onRemoveSideMenuImage($event)">
                                                                <div class="iconAndFileDesc">
                                                                    {{ "remove.image" | translate }}
                                                                </div>
                                                            </mat-checkbox>
                                                        }

                                                    </div>
                                                }
                                            </div>
                                            <mat-error></mat-error>
                                            {{ toBigSideMenuImage }}
                                        </div>

                                    </mat-expansion-panel>
                                </ng-container>
                            </div>
                        }
                    }
                </ng-container>
            </ng-container>
        }

        <button class="myButton_full_width" [disabled]="!form.valid" (click)="onCreateDetail()" mat-fab extended>
            @if (isNew) {
                Create
            } @else {
                Update
            }
        </button>

    </mat-card-content>
</mat-card>
